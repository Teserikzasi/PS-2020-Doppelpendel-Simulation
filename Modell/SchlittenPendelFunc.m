% Level 2 m-s-function : 'SchlittenPendelFunc.m'
%
% Created by sys2sfct at 28-Jul-2020 11:49:56 from the following system:
% Name        : SchlittenPendelNLZSR
% Description : Nichtlineare Zustandsraumdarstellung des Schlitten-Doppelpendel-Systems
%
% System type : NLTI
% State eq.   : dx=f(x,u)
% Output eq.  : y=h(x)
%
% Nb. Inputs  : 1
% Nb. States  : 6
% Nb. Outputs : 3
%
%     u = [ F ]'
%     x = [ x0, x0_p, phi1, phi1_p, phi2, phi2_p ]'
%     y = [ x0, phi1, phi2 ]'
%
% Nb. Params  : 0
%
%

function SchlittenPendelFunc(block)

  setup(block);
  
end % function Systemgleichung

function setup(block)

    %% Register number of dialog parameters
    block.NumDialogPrms = 2 + 0;

    %% Set block sample time to continuous
    block.SampleTimes = [0 0];

    %stParam = block.DialogPrm(0).Data;
    %x0 = block.DialogPrm(1+0).Data;
    bShowStates = block.DialogPrm(2+0).Data;
    
    % Dimensionen feststellen, wenn nicht explizit gegeben
    
    block.NumContStates = 6;
    
    %% Register number of input and output ports
    
    nInputs = 1;
    
    if (nInputs == 0)
        block.NumInputPorts = 0;
    else
        block.NumInputPorts = 1;
        block.InputPort(1).Dimensions = [nInputs, 1];
        block.InputPort(1).DirectFeedthrough = false;
    end

    
    if (bShowStates)
        block.NumOutputPorts = 2;
    else
        block.NumOutputPorts = 1;
    end
    
    block.OutputPort(1).Dimensions = [3, 1];
    
    if (bShowStates)
        block.OutputPort(2).Dimensions = [6, 1];
    end



    %% Register methods
    block.RegBlockMethod('SetInputPortSamplingMode',    @SetInputPortSMode);
    block.RegBlockMethod('Outputs',                        @Output);  
    block.RegBlockMethod('InitializeConditions',        @InitConditions);
    block.RegBlockMethod('Derivatives',                    @Derivative);  

end % function setup


function SetInputPortSMode(block, idx, fd)

    block.InputPort(idx).SamplingMode = fd;
    
    if (idx == 1)
        for o = 1:block.NumOutputPorts
            block.OutputPort(o).SamplingMode = fd;
        end % for o
    end
    
end % function SetInputPortSMode


function InitConditions(block)  

    % Initialize Dwork
    x0 = block.DialogPrm(1+0).Data;
    
    if ( (length(x0) == 1) && (x0 == 0) )
        x0 = zeros(block.NumContStates, 1);
    end

    block.ContStates.Data = x0;
  
end % function InitConditions


function Output(block)

    bShowStates = block.DialogPrm(2+0).Data;
    
    x = block.ContStates.Data;
    t = block.CurrentTime;
    
    if (0 > 0)
        p = block.DialogPrm(0).Data;
    end


    bDirectFeedthrough = false;
    if (bDirectFeedthrough)
        u = block.InputPort(1).Data;
    end

    y = [x(1); x(3); x(5)];
    
    block.OutputPort(1).Data = y;
    
    if bShowStates
        block.OutputPort(2).Data = x;
    end

end % function Output


function Derivative(block)

    nInputs = 1;
    if (nInputs > 0)
        u = block.InputPort(1).Data;
    end
    
    if (0 > 0)
        p = block.DialogPrm(0).Data;
    end

    x = block.ContStates.Data;
    t = block.CurrentTime;
    
    dx = [x(2); ((749525677476319871896934893653258217762493*atan(100*x(2)))/32451855365842672678315602057625600000000000 - (303275493160437526784067365189685488367*atan(100*x(2))*cos(2*x(3) - 2*x(5)))/66461399789245793645190353014017228800000 - (107075096782331410270990699093322602537499*u(1)*pi)/162259276829213363391578010288128000000000000 + (1177826064605645512980897690026548627912489*x(2)*pi)/101412048018258352119736256430080000000000000 + (81290430534956109074364059194324349241*atan(100*x(4) - 100*x(6))*cos(2*x(3) - x(5)))/265845599156983174580761412056068915200000000 + (12279321588153006433058172676407073598237187*atan(100*x(4))*cos(x(3)))/64903710731685345356631204115251200000000000000 - (896495688573161480273781552044235124953*cos(x(3) - 2*x(5))*atan(100*x(4)))/20769187434139310514121985316880384000000000 + (76795655945991419110288289548081563402540301871018202153*atan(100*x(4) - 100*x(6))*cos(x(3)))/239452428260295134118491722992235809940427987841187840000000000 - (4071251648316410529717035129214130727727*atan(100*x(4) - 100*x(6))*cos(x(5)))/10633823966279326983230456482242756608000000000 - (5606740890567782117543116578762622080514697931510507*cos(x(3) - 2*x(5))*atan(100*x(4) - 100*x(6)))/76624777043294442917917351357515459180936956109180108800000 - (126866873854779450606844820653971922861951436679*pi*sin(2*x(3)))/129807421463370690713262408230502400000000000000000 - (241991953101551144175905060271541308766598739*pi*sin(2*x(5)))/3323069989462289682259517650700861440000000000000 + (45648035643691473728840790618613656499023*x(4)*pi*cos(x(3)))/2596148429267413814265248164610048000000000000 - (2419988970306931715196057*x(4)*pi*cos(x(5)))/230584300921369395200000000000 - (45648035643691473728840790618613656499023*x(6)*pi*cos(x(3)))/5192296858534827628530496329220096000000000000 + (2419988970306931715196057*x(6)*pi*cos(x(5)))/230584300921369395200000000000 + (115956112204986276625224671965579076591802774129998506522509*x(6)^2*pi*sin(2*x(3) - x(5)))/14965776766268445882405732687014738121276749240074240000000000000 - (3332697727037775019605135881205335037*x(4)*pi*cos(x(3) - 2*x(5)))/830767497365572420564879412675215360000000 + (3332697727037775019605135881205335037*x(6)*pi*cos(x(3) - 2*x(5)))/1661534994731144841129758825350430720000000 + (312917938286118567585239023348464619113907107033*x(4)^2*pi*sin(x(3)))/4153837486827862102824397063376076800000000000000000 + (101540531280352215655821019679685219048518156843989631364807*x(6)^2*pi*sin(x(5)))/9353610478917778676503582929384211325797968275046400000000000000 + (43325070451491075254866766455669355481*u(1)*pi*cos(2*x(3) - 2*x(5)))/332306998946228968225951765070086144000000 - (476575774966401827803534431012362910291*x(2)*pi*cos(2*x(3) - 2*x(5)))/207691874341393105141219853168803840000000 + (48319770497961296861631*x(4)*pi*cos(2*x(3) - x(5)))/5764607523034234880000000000 - (48319770497961296861631*x(6)*pi*cos(2*x(3) - x(5)))/5764607523034234880000000000 - (3206825066585285294889669504108090737987547*x(4)^2*pi*sin(x(3) - 2*x(5)))/1329227995784915872903807060280344576000000000000)/(pi*((129324030433006575542145586803233356638074859*cos(2*x(3)))/1298074214633706907132624082305024000000000000000 + (246678851275791176529974577239083902922119*cos(2*x(5)))/33230699894622896822595176507008614400000000000 + (7228678025806293659698873013644352185948629*cos(2*x(3) - 2*x(5)))/3323069989462289682259517650700861440000000000 - 231419601219649353134978882096805936262266634409/20769187434139310514121985316880384000000000000000)); x(4); ((8757925648581553268758590848054986149816617*atan(100*x(4)))/324518553658426726783156020576256000000000000 + (54772622418972528775357087469162817635403597039807695323*atan(100*x(4) - 100*x(6)))/1197262141301475670592458614961179049702139939205939200000000 - (431287760812906316734085890674047852347284456270039*cos(2*x(5))*atan(100*x(4) - 100*x(6)))/1915619426082361072947933783937886479523423902729502720000 + (32557344418518785385719668580130060036493*x(4)*pi)/12980742146337069071326240823050240000000000 - (32557344418518785385719668580130060036493*x(6)*pi)/25961484292674138142652481646100480000000000 + (319536249505840316101885534330295595493161*atan(100*x(2))*cos(x(3)))/5192296858534827628530496329220096000000000 - (6253110041150469928797235322640334557*atan(100*x(4) - 100*x(6))*cos(x(3) + x(5)))/6646139978924579364519035301401722880000000 - (1525538759511100588406666308275662014371389343699*pi*sin(x(3)))/5192296858534827628530496329220096000000000000000 - (23328884089264425137235951168437345259*cos(x(3) - 2*x(5))*atan(100*x(2)))/1661534994731144841129758825350430720000 - (545487164870459544628045725106546884185815773*pi*sin(x(3) - 2*x(5)))/8307674973655724205648794126752153600000000000 - (68961206813320113867213965541864240381*atan(100*x(4))*cos(2*x(5)))/519229685853482762853049632922009600000000 + (1872594783459257762231193977090502836637*cos(x(3) - x(5))*atan(100*x(4) - 100*x(6)))/26584559915698317458076141205606891520000000 - (45648035643691473728840790618613656499023*u(1)*pi*cos(x(3)))/25961484292674138142652481646100480000000000 + (502128392080606211017248696804750221489253*x(2)*pi*cos(x(3)))/16225927682921336339157801028812800000000000 + (7228678025806293659698873013644352185948629*x(4)^2*pi*sin(2*x(3) - 2*x(5)))/3323069989462289682259517650700861440000000000 + (3332697727037775019605135881205335037*u(1)*pi*cos(x(3) - 2*x(5)))/8307674973655724205648794126752153600000 - (36659674997415525215656494693258685407*x(2)*pi*cos(x(3) - 2*x(5)))/5192296858534827628530496329220096000000 + (1113087353295805997463867*x(4)*pi*cos(x(3) - x(5)))/576460752303423488000000000 - (1113087353295805997463867*x(6)*pi*cos(x(3) - x(5)))/576460752303423488000000000 + (8919700938845098201940359381967621276292521086922962040193*x(6)^2*pi*sin(x(3) + x(5)))/374144419156711147060143317175368453031918731001856000000000000 - (256361363618290386123471990861948849*x(4)*pi*cos(2*x(5)))/20769187434139310514121985316880384000000 + (256361363618290386123471990861948849*x(6)*pi*cos(2*x(5)))/41538374868278621028243970633760768000000 + (1057298344229930461544133270599237067511274074062464205093747*x(6)^2*pi*sin(x(3) - x(5)))/374144419156711147060143317175368453031918731001856000000000000 + (129324030433006575542145586803233356638074859*x(4)^2*pi*sin(2*x(3)))/1298074214633706907132624082305024000000000000000 - (3716905422920099758587*x(4)*pi*cos(x(3) + x(5)))/144115188075855872000000000 + (3716905422920099758587*x(6)*pi*cos(x(3) + x(5)))/144115188075855872000000000)/(pi*((129324030433006575542145586803233356638074859*cos(2*x(3)))/1298074214633706907132624082305024000000000000000 + (246678851275791176529974577239083902922119*cos(2*x(5)))/33230699894622896822595176507008614400000000000 + (7228678025806293659698873013644352185948629*cos(2*x(3) - 2*x(5)))/3323069989462289682259517650700861440000000000 - 231419601219649353134978882096805936262266634409/20769187434139310514121985316880384000000000000000)); x(6); -((489884136630870949422017489*atan(100*x(4) - 100*x(6)))/1475739525896764129280000000000 + (338238393485729078031417*atan(100*x(2))*cos(2*x(3) - x(5)))/5764607523034234880000000 - (90661940216057065559391*cos(2*x(3))*atan(100*x(4) - 100*x(6)))/23058430092136939520000000000 + (291191581799*x(4)*pi)/32000000000000 - (291191581799*x(6)*pi)/32000000000000 - (7908852459761474183727748098399*pi*sin(2*x(3) - x(5)))/28823037615171174400000000000000 - (999847558765506835059903*atan(100*x(4))*cos(x(3) + x(5)))/1801439850948198400000000000 - (16939922792148522006372399*atan(100*x(2))*cos(x(5)))/230584300921369395200000000 - (6253110041150469928797235322640334557*atan(100*x(4) - 100*x(6))*cos(x(3) + x(5)))/6646139978924579364519035301401722880000000 + (79651304784399140029143297298413*pi*sin(x(5)))/230584300921369395200000000000000 + (299420498036571813317780223*cos(x(3) - x(5))*atan(100*x(4)))/7205759403792793600000000000 + (1872594783459257762231193977090502836637*cos(x(3) - x(5))*atan(100*x(4) - 100*x(6)))/26584559915698317458076141205606891520000000 + (2419988970306931715196057*u(1)*pi*cos(x(5)))/1152921504606846976000000000 - (26619878673376248867156627*x(2)*pi*cos(x(5)))/720575940379279360000000000 + (7228678025806293659698873013644352185948629*x(6)^2*pi*sin(2*x(3) - 2*x(5)))/3323069989462289682259517650700861440000000000 + (1113087353295805997463867*x(4)*pi*cos(x(3) - x(5)))/288230376151711744000000000 - (1113087353295805997463867*x(6)*pi*cos(x(3) - x(5)))/576460752303423488000000000 - (3576521622001830510804927597*x(4)^2*pi*sin(x(3) + x(5)))/115292150460684697600000000000000 - (53890281*x(4)*pi*cos(2*x(3)))/500000000000 + (53890281*x(6)*pi*cos(2*x(3)))/500000000000 - (48319770497961296861631*u(1)*pi*cos(2*x(3) - x(5)))/28823037615171174400000000 + (531517475477574265477941*x(2)*pi*cos(2*x(3) - x(5)))/18014398509481984000000000 + (9455559448743298159539597145437*x(4)^2*pi*sin(x(3) - x(5)))/461168601842738790400000000000000 - (246678851275791176529974577239083902922119*x(6)^2*pi*sin(2*x(5)))/33230699894622896822595176507008614400000000000 - (3716905422920099758587*x(4)*pi*cos(x(3) + x(5)))/72057594037927936000000000 + (3716905422920099758587*x(6)*pi*cos(x(3) + x(5)))/144115188075855872000000000)/(pi*((129324030433006575542145586803233356638074859*cos(2*x(3)))/1298074214633706907132624082305024000000000000000 + (246678851275791176529974577239083902922119*cos(2*x(5)))/33230699894622896822595176507008614400000000000 + (7228678025806293659698873013644352185948629*cos(2*x(3) - 2*x(5)))/3323069989462289682259517650700861440000000000 - 231419601219649353134978882096805936262266634409/20769187434139310514121985316880384000000000000000))];

    block.Derivatives.Data = dx;

end % function Derivative
