% Level 2 m-s-function : 'SchlittenPendelFunc.m'
%
<<<<<<< HEAD
% Created by sys2sfct at 01-Oct-2020 15:53:21 from the following system:
=======
% Created by sys2sfct at 30-Sep-2020 18:19:11 from the following system:
>>>>>>> master
% Name        : SchlittenPendel NLZSR (F)
% Description : Nichtlineare Zustandsraumdarstellung des Schlitten-Doppelpendel-Systems (Eingang: F) (Parameter: Doppelpendel rtm (Ribeiro))
%
% System type : NLTI
% State eq.   : dx=f(x,u)
% Output eq.  : y=h(x)
%
% Nb. Inputs  : 1
% Nb. States  : 6
% Nb. Outputs : 3
%
%     u = [ F ]'
%     x = [ x0, x0_p, phi1, phi1_p, phi2, phi2_p ]'
%     y = [ x0, phi1, phi2 ]'
%
% Nb. Params  : 0
%
%

function SchlittenPendelFunc(block)

  setup(block);
  
end % function Systemgleichung

function setup(block)

    %% Register number of dialog parameters
    block.NumDialogPrms = 2 + 0;

    %% Set block sample time to continuous
    block.SampleTimes = [0 0];

    %stParam = block.DialogPrm(0).Data;
    %x0 = block.DialogPrm(1+0).Data;
    bShowStates = block.DialogPrm(2+0).Data;
    
    % Dimensionen feststellen, wenn nicht explizit gegeben
    
    block.NumContStates = 6;
    
    %% Register number of input and output ports
    
    nInputs = 1;
    
    if (nInputs == 0)
        block.NumInputPorts = 0;
    else
        block.NumInputPorts = 1;
        block.InputPort(1).Dimensions = [nInputs, 1];
        block.InputPort(1).DirectFeedthrough = false;
    end

    
    if (bShowStates)
        block.NumOutputPorts = 2;
    else
        block.NumOutputPorts = 1;
    end
    
    block.OutputPort(1).Dimensions = [3, 1];
    
    if (bShowStates)
        block.OutputPort(2).Dimensions = [6, 1];
    end



    %% Register methods
    block.RegBlockMethod('SetInputPortSamplingMode',    @SetInputPortSMode);
    block.RegBlockMethod('Outputs',                        @Output);  
    block.RegBlockMethod('InitializeConditions',        @InitConditions);
    block.RegBlockMethod('Derivatives',                    @Derivative);  

end % function setup


function SetInputPortSMode(block, idx, fd)

    block.InputPort(idx).SamplingMode = fd;
    
    if (idx == 1)
        for o = 1:block.NumOutputPorts
            block.OutputPort(o).SamplingMode = fd;
        end % for o
    end
    
end % function SetInputPortSMode


function InitConditions(block)  

    % Initialize Dwork
    x0 = block.DialogPrm(1+0).Data;
    
    if ( (length(x0) == 1) && (x0 == 0) )
        x0 = zeros(block.NumContStates, 1);
    end

    block.ContStates.Data = x0;
  
end % function InitConditions


function Output(block)

    bShowStates = block.DialogPrm(2+0).Data;
    
    x = block.ContStates.Data;
    t = block.CurrentTime;
    
    if (0 > 0)
        p = block.DialogPrm(0).Data;
    end


    bDirectFeedthrough = false;
    if (bDirectFeedthrough)
        u = block.InputPort(1).Data;
    end

    y = [x(1); x(3); x(5)];
    
    block.OutputPort(1).Data = y;
    
    if bShowStates
        block.OutputPort(2).Data = x;
    end

end % function Output


function Derivative(block)

    nInputs = 1;
    if (nInputs > 0)
        u = block.InputPort(1).Data;
    end
    
    if (0 > 0)
        p = block.DialogPrm(0).Data;
    end

    x = block.ContStates.Data;
    t = block.CurrentTime;
    
    dx = [x(2); ((348764048701396112190941979559110515707864191*x(2))/3245185536584267267831560205762560000000000000 - (20515532276552712481820116444653559747521423*u(1))/3245185536584267267831560205762560000000000000 - (86951454494513389038746308267602852222811195214121*sin(2*x(3)))/3245185536584267267831560205762560000000000000000000 + (3141398156584964200463211999586123923318684177*sin(2*x(5)))/1622592768292133633915780102881280000000000000000 + (27552359847410292863084416385169730740921271089*tanh(100*x(2)))/324518553658426726783156020576256000000000000000 - (452435410320437269921168798426093066623*tanh(100*x(2))*cos(2*x(3) - 2*x(5)))/8112963841460668169578900514406400000000 + (2357198679403132504583538333141663463393459802022993*x(4)^2*sin(x(3)))/1622592768292133633915780102881280000000000000000000000 + (13003222513836064810435620036910800303108229560649981919007*x(6)^2*sin(x(5)))/58460065493236116728147393308651320786237301719040000000000000 + (336884147669722464572724347301632961*u(1)*cos(2*x(3) - 2*x(5)))/81129638414606681695789005144064000000 - (5727030510385281897736313904127760337*x(2)*cos(2*x(3) - 2*x(5)))/81129638414606681695789005144064000000 + (491273627313566007678478462190624910652869*x(4)*cos(2*x(3) - x(5)))/41538374868278621028243970633760768000000000000 - (491273627313566007678478462190624910652869*x(6)*cos(2*x(3) - x(5)))/41538374868278621028243970633760768000000000000 + (314415121480682237438578019055300486050169*cos(2*x(3) - x(5))*tanh(100*x(4) - 100*x(6)))/83076749736557242056487941267521536000000000000 + (451515942995392408017648207891583560843969897*x(4)^2*sin(x(3) - 2*x(5)))/8112963841460668169578900514406400000000000000000 + (202589306528030821198659209929706501813919*tanh(100*x(4))*cos(x(3)))/162259276829213363391578010288128000000000000 + (172897919136891797043068754620213002094570213133525122760717*x(4)*cos(x(3)))/935361047891777867650358292938421132579796827504640000000000000 - (47082484795401298591850896848367025921772257*x(4)*cos(x(5)))/4153837486827862102824397063376076800000000000000 - (1979697454524109388749819640473927449917407464541187961*x(6)*cos(x(3)))/299315535325368917648114653740294762425534984801484800000000 + (47082484795401298591850896848367025921772257*x(6)*cos(x(5)))/4153837486827862102824397063376076800000000000000 + (159771589255624709969118946949456864675644821264895922619*x(6)^2*sin(2*x(3) - x(5)))/584600654932361167281473933086513207862373017190400000000000 - (642708054774151368582006024284675649*cos(x(3) - 2*x(5))*tanh(100*x(4)))/811296384146066816957890051440640000000 + (1267006370895429978675080625214715620191124430881601661*tanh(100*x(4) - 100*x(6))*cos(x(3)))/598631070650737835296229307480589524851069969602969600000000 - (30132790269056830382336401334676711023169157*tanh(100*x(4) - 100*x(6))*cos(x(5)))/8307674973655724205648794126752153600000000000000 - (548513083870964211192496022309700396714002466693289107*x(4)*cos(x(3) - 2*x(5)))/4676805239458889338251791464692105662898984137523200000000 + (6280526459388817844184203494963989370305904305831*x(6)*cos(x(3) - 2*x(5)))/1496577676626844588240573268701473812127674924007424000 - (4019536934008843324707919266642920694095254698531*cos(x(3) - 2*x(5))*tanh(100*x(4) - 100*x(6)))/2993155353253689176481146537402947624255349848014848000)/((88635529556078887909017643493988636312753511941*cos(2*x(3)))/32451855365842672678315602057625600000000000000000 - (3202240730463775943387575942493500431517517*cos(2*x(5)))/16225927682921336339157801028812800000000000000 + (5750528320650952220587959369130322220400989*cos(2*x(3) - 2*x(5)))/81129638414606681695789005144064000000000000 - 3580491838371099511324810318815739945920528200941/32451855365842672678315602057625600000000000000000); x(4); ((81037989809107256329307071528326468047245790257346119829*x(4))/9353610478917778676503582929384211325797968275046400000000 - (927892614010116948125815487099773853781590602143457*x(6))/2993155353253689176481146537402947624255349848014848000 - (40008994911763008002814100291608837575981349*sin(x(3) - 2*x(5)))/16225927682921336339157801028812800000000000 + (94954469318130890310368830715972538103*tanh(100*x(4)))/1622592768292133633915780102881280000000 + (593851272966474832680898221315470090157194830580357*tanh(100*x(4) - 100*x(6)))/5986310706507378352962293074805895248510699696029696000 - (66139966152427659779875672149289904029190095377*sin(x(3)))/16225927682921336339157801028812800000000000000 - (3890163715396909299237560441912768771021294090023327*x(4)*cos(2*x(5)))/9353610478917778676503582929384211325797968275046400000 + (44542740846729204568682294290524747307134073091*x(6)*cos(2*x(5)))/2993155353253689176481146537402947624255349848014848 - (28507354141906690246155455791793763787909607791*cos(2*x(5))*tanh(100*x(4) - 100*x(6)))/5986310706507378352962293074805895248510699696029696 + (76885520319124336902725654500835729657434717538243408841*x(6)^2*sin(x(3) - x(5)))/1169201309864722334562947866173026415724746034380800000000 + (88635529556078887909017643493988636312753511941*x(4)^2*sin(2*x(3)))/32451855365842672678315602057625600000000000000000 + (1011440292442919676095908248831211271137893*tanh(100*x(2))*cos(x(3)))/3245185536584267267831560205762560000000000 - (3484210122791248281407648668018616387609*x(4)*cos(x(3) + x(5)))/83076749736557242056487941267521536000000000 + (3484210122791248281407648668018616387609*x(6)*cos(x(3) + x(5)))/83076749736557242056487941267521536000000000 - (2229894478586398847082113610321280042909*tanh(100*x(4) - 100*x(6))*cos(x(3) + x(5)))/166153499473114484112975882535043072000000000 - (753120098617214948693900408660618965851*u(1)*cos(x(3)))/32451855365842672678315602057625600000000 + (12803041676492654127796306947230522419467*x(2)*cos(x(3)))/32451855365842672678315602057625600000000 + (5750528320650952220587959369130322220400989*x(4)^2*sin(2*x(3) - 2*x(5)))/81129638414606681695789005144064000000000000 - (3208761775322250141284885095220518203*cos(x(3) - 2*x(5))*tanh(100*x(2)))/16225927682921336339157801028812800000 - (4558213154426605450936212938189189*cos(2*x(5))*tanh(100*x(4)))/1622592768292133633915780102881280000 + (2389249274253350812572513101430021*u(1)*cos(x(3) - 2*x(5)))/162259276829213363391578010288128000 - (40617237662306963813732722724310357*x(2)*cos(x(3) - 2*x(5)))/162259276829213363391578010288128000 + (55571533573539156057618438078637572913591*x(4)*cos(x(3) - x(5)))/83076749736557242056487941267521536000000000 - (55571533573539156057618438078637572913591*x(6)*cos(x(3) - x(5)))/83076749736557242056487941267521536000000000 + (35565781487065059031250854001453617298291*cos(x(3) - x(5))*tanh(100*x(4) - 100*x(6)))/166153499473114484112975882535043072000000000 + (1133131838692373829568219481911041593444289512516992359*x(6)^2*sin(x(3) + x(5)))/1169201309864722334562947866173026415724746034380800000000)/((88635529556078887909017643493988636312753511941*cos(2*x(3)))/32451855365842672678315602057625600000000000000000 - (3202240730463775943387575942493500431517517*cos(2*x(5)))/16225927682921336339157801028812800000000000000 + (5750528320650952220587959369130322220400989*cos(2*x(3) - 2*x(5)))/81129638414606681695789005144064000000000000 - 3580491838371099511324810318815739945920528200941/32451855365842672678315602057625600000000000000000); x(6); -((4250761478404455060061443409046691*x(4))/2305843009213693952000000000000000000 - (4250761478404455060061443409046691*x(6))/2305843009213693952000000000000000000 - (3129572685119227678909578992807145951*sin(2*x(3) - x(5)))/450359962737049600000000000000000000 + (2720487346178851173756027927701391*tanh(100*x(4) - 100*x(6)))/4611686018427387904000000000000000000 + (2981879967332747815259388914665049049*sin(x(5)))/450359962737049600000000000000000000 - (272540933696324865190650762541691*x(4)*cos(2*x(3)))/2305843009213693952000000000000000000 + (272540933696324865190650762541691*x(6)*cos(2*x(3)))/2305843009213693952000000000000000000 + (250994888205770434260974424897*tanh(100*x(2))*cos(2*x(3) - x(5)))/450359962737049600000000000000 - (174426197565647909574795822696391*cos(2*x(3))*tanh(100*x(4) - 100*x(6)))/4611686018427387904000000000000000000 - (186891204918667486419191679*u(1)*cos(2*x(3) - x(5)))/4503599627370496000000000000 + (3177150483617347269126258543*x(2)*cos(2*x(3) - x(5)))/4503599627370496000000000000 + (175931386736742207063861887801094783383*x(4)^2*sin(x(3) - x(5)))/450359962737049600000000000000000000000 - (356551305837741516643706111*tanh(100*x(4))*cos(x(3) + x(5)))/45035996273704960000000000000 + (3202240730463775943387575942493500431517517*x(6)^2*sin(2*x(5)))/16225927682921336339157801028812800000000000000 - (24054747396665940080404137812141*tanh(100*x(2))*cos(x(5)))/45035996273704960000000000000000 - (304295324868775149485974200947095544402614573*x(4)*cos(x(3) + x(5)))/259614842926741381426524816461004800000000000000 + (3484210122791248281407648668018616387609*x(6)*cos(x(3) + x(5)))/83076749736557242056487941267521536000000000 - (2229894478586398847082113610321280042909*tanh(100*x(4) - 100*x(6))*cos(x(3) + x(5)))/166153499473114484112975882535043072000000000 + (17911204316206954639169127187*u(1)*cos(x(5)))/450359962737049600000000000000 - (304490473375518228865875162179*x(2)*cos(x(5)))/450359962737049600000000000000 + (5750528320650952220587959369130322220400989*x(6)^2*sin(2*x(3) - 2*x(5)))/81129638414606681695789005144064000000000000 + (5686827764330680537489088689*cos(x(3) - x(5))*tanh(100*x(4)))/45035996273704960000000000000 + (4853369132820607402326651043965432605331801827*x(4)*cos(x(3) - x(5)))/259614842926741381426524816461004800000000000000 - (55571533573539156057618438078637572913591*x(6)*cos(x(3) - x(5)))/83076749736557242056487941267521536000000000 + (35565781487065059031250854001453617298291*cos(x(3) - x(5))*tanh(100*x(4) - 100*x(6)))/166153499473114484112975882535043072000000000 + (250484800813859525059752234615783383*x(4)^2*sin(x(3) + x(5)))/450359962737049600000000000000000000000)/((88635529556078887909017643493988636312753511941*cos(2*x(3)))/32451855365842672678315602057625600000000000000000 - (3202240730463775943387575942493500431517517*cos(2*x(5)))/16225927682921336339157801028812800000000000000 + (5750528320650952220587959369130322220400989*cos(2*x(3) - 2*x(5)))/81129638414606681695789005144064000000000000 - 3580491838371099511324810318815739945920528200941/32451855365842672678315602057625600000000000000000)];

    block.Derivatives.Data = dx;

end % function Derivative
